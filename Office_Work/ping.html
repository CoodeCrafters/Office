<!DOCTYPE html>
<html>
<head>
    <title>Server Keepalive Monitor</title>
    <style>
        /* [Keep all your existing styles] */
        .countdown {
            font-size: 1.2em;
            color: #d4a76a;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- [Keep all your existing HTML structure] -->
    
    <script>
        const statusDiv = document.getElementById('status');
        const statusElements = statusDiv.querySelectorAll('.highlight');
        const sand = document.querySelector('.sand');
        let countdownInterval;
        let secondsRemaining = 180; // 3 minutes in seconds

        const updateCountdown = () => {
            const mins = Math.floor(secondsRemaining / 60);
            const secs = secondsRemaining % 60;
            statusElements[3].textContent = `${mins}m ${secs}s`;
            secondsRemaining--;
            
            if (secondsRemaining < 0) {
                secondsRemaining = 180;
            }
        };

        const resetAnimation = () => {
            sand.style.animation = 'none';
            sand.offsetHeight; // Trigger reflow
            sand.style.animation = 'flow 180s linear infinite';
        };

        const pingServer = () => {
            fetch('https://office-6.onrender.com/keepalive?t=' + Date.now())
                .then(response => {
                    if (!response.ok) throw new Error('Server error');
                    return response.json();
                })
                .then(data => {
                    statusElements[0].textContent = data.status;
                    statusElements[1].textContent = data.message;
                    statusElements[2].textContent = data.timestamp;
                    
                    // Reset countdown when we get a fresh ping
                    if (data.message.includes("keepalive ping")) {
                        secondsRemaining = 180;
                    }
                    
                    resetAnimation();
                })
                .catch(error => {
                    statusElements[0].textContent = 'error';
                    statusElements[1].textContent = 'Connection failed';
                    statusElements[2].textContent = new Date().toLocaleString();
                });
        };

        // Start countdown timer
        countdownInterval = setInterval(updateCountdown, 1000);
        
        // Initial ping and then every 3 minutes
        pingServer();
        setInterval(pingServer, 180000);  // 180,000ms = 3 minutes
        
        // Initial animation reset
        resetAnimation();
    </script>
</body>
</html>
